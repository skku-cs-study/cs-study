> 💡 `은행원 알고리즘(Banker’s Algorithm)` 에 대한 구체적인 내용은 따로 [링크](https://jhnyang.tistory.com/102)를 참고 바람

## 교착 상태(Deadlock)란?

- 두 개 이상의 프로세스나 스레드가 서로 자원을 얻지 못해서 다음 처리를 하지 못하는 상태
- 무한히 다음 자원을 기다리게 됨
- 한정된 자원을 여러 곳에서 사용하려고 할 때 발생

## 교착 상태(Deadlock) 발생 조건

> **아래 4가지 조건이 모두 동시에 만족해야 교착 상태 성립** (하나라도 충족되지 않으면 해결 가능)
> 
1. **상호 배제 (Mutual exclusion)**
    - 한 번에 프로세스 하나만 해당 자원을 사용할 수 있다.
2. **점유 대기 (Hold-and-wait)**
    - 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용하고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 존재해야 한다.
3. **비선점 (No preemption)**
    - 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 빼앗을 수 없다.
4. **순환 대기 (Circular wait)**
    - 프로세스들이 순환 형태로 자원을 대기하고 있어야 한다.
    - 공유자원과 공유자원을 사용하기 위해 대기하는 프로세스들이 원형(사이클)으로 구성되어 있어 자신에게 할당된 자원을 점유하면서 앞이나 뒤에 있는 프로세스의 자원을 요구해야 한다는 뜻
    
    ![](https://user-images.githubusercontent.com/25472942/229831151-11c8a04a-f3e0-4872-8030-c7e23709541d.png)
    

## 교착 상태(Deadlock) 해결 방법

### 무시 (Ignorance)

> 교착 상태 발생 확률이 낮은 시스템에서 아무런 조치도 취하지 않고 무시하는 방법
> 
- 현대 OS에서 대부분 사용하는 방식. (데드락 발생 확률이 낮고, 해결 비용이 크기 때문)
- 교착 상태에 대한 Handling을 사용자에게 맡긴다. (인위적인 재시작)

### 예방 (Prevention)

> 교착 상태의 4가지 발생 조건중 하나가 성립하지 않게 하는 방법
> 
- **현실적으로 가능한 예방 기법 = 순환 대기 조건 예방**
    - `상호 배제 방지`: 동시에 여러 프로세스가 자원을 공유하여 사용할 수 있게 한다.
        - 동기화 문제를 피할 수 없음
    - `점유 대기 방지`: "프로세스는 자원을 요청할 때 어떠한 자원도 보유해서는 안된다"를 보장
        - 프로세스 실행에 필요한 모든 자원을 한꺼번에 요구하고 허용할 때까지 작업을 보류
        - 안쓰는 자원으로 인한 자원의 효율성 감소
        - 인기 많은 자원을 할당받으려고 대기한다면 다른 우선순위 높은 프로세스들로 인해 영원히 대기할 수 있음 (Starvation)
    - `비선점 방지`: 프로세스에게 할당된 자원이 선점권이 없다고 가정할 때, 높은 우선순위의 프로세스가 해당 자원을 선점할 수 있도록 한다.
        - 재시작시 현재 자원을 모두 반납 후 추가로 필요한 자원까지 모두 재할당 받아야 함
        - 자원의 상태가 쉽게 저장/복원되는 CPU 레지스터 또는 DB 트랜잭션에서나 사용 가능한 방법
        - 교착 상태가 가장 많이 일어나는 Mutex, Semaphore 같은 자원에 대해서는 적용이 어려움
    - `순환 대기 방지`: 모든 자원에 순서를 매겨 반드시 정해진 순서대로 자원을 할당받도록 한다.
- **문제점**
    1. 자원에 대한 이용률이 낮아진다
    2. 시스템의 처리율이 감소한다
    3. Starvation 문제 발생 가능

### 회피 (Avoidance)

> 앞으로 자원을 어떻게 요청할지에 대한 정보를 통해 순환 대기 상태가 발생하지 않도록 자원을 할당하는 방법
> 
- `안정 상태(safe state)`: 시스템의 프로세스들이 요청하는 모든 자원을, 데드락을 발생시키지 않으면서도 차례로 모두에게 할당해 줄 수 있음
    - 불안정 상태 = 교착 상태 발생 가능성이 존재함
- `안전 순서(safe sequence)`: 특정한 순서로 프로세스들에게 자원을 할당, 실행 및 종료 등의 작업을 할 때 데드락이 발생하지 않는 순서를 찾을 수 있음
- 회피는 즉, 자원을 할당한 후에도 시스템이 항상 Safe state에 있을 수 있도록 할당을 허용하는 것
- 해당 특징을 살린 대표적인 회피 알고리즘 = `은행원 알고리즘(Banker’s Algorithm)`
    - 다익스트라가 제안한 방법으로 은행에서 모든 고객의 요구가 충족되도록 현금을 할당하는데서 유래된 기법
    - 미리 결정된 모든 자원들의 최대 가능한 할당량을 가지고 시뮬레이션해서 `safe state` 에 들 수 있는지 여부를 검사

### 탐지-회복 (Detection-Recovery)

> 시스템 검사를 통해 교착 상태 발생을 탐지하고, 이를 회복시키는 방법
> 
- **탐지 기법**
    - `은행원 알고리즘(Banker’s Algorithm)` 에서 사용했던 Allocation, Request, Available 등으로 데드락 발생 여부 탐색
    - 이 외에도 `자원 할당 그래프(Resource-Allocation Graph)` 를 통해 탐지하는 방법도 있음
- **회복 기법**
    - 단순히 프로세스를 1개 이상 중단시키기 (abort)
        - **교착 상태에 빠진 모든 프로세스를 중단시키는 방법** : 계속 연산중이던 프로세스들도 모두 일시에 중단되어 부분 결과가 폐기되는 부작용이 발생할 수 있음
        - **프로세스를 하나씩 중단 시킬 때마다 탐지 알고리즘으로 데드락을 탐지하면서 회복시키는 방법** : 매번 탐지 알고리즘을 호출 및 수행해야 하므로 부담이 되는 작업일 수 있음
    - 자원 선점하기 (preempt)
        - 프로세스에 할당된 자원을 선점해서, 교착 상태를 해결할 때까지 그 자원을 다른 프로세스에 할당해 주는 방법
